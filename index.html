<!DOCTYPE html>
<html>
    <head>
        <title>
            Image Reveal On Scratch | Vanilla Javascript
        </title>
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>

        <canvas id="canvas" width="600" height="300" style="border:solid black 1px;">
            Your browser does not support canvas element.
          </canvas>
          <br>
          <!-- Log: <pre id="log" style="border: 1px solid #ccc;"></pre> -->

        <script type="text/Javascript">
            // var touched = false;
            // document.addEventListener('touchstart', function(e){
            //     touched = true;
            // })
            // document.addEventListener('touchmove', function(e)
            // {
            //     e.preventDefault();
            //      if (touched = true){
            //         const body = document.querySelector('body');
            //         const bubbles = document.createElement('span');
            //         bubbles.style.left = -75 + e.offsetX+'px';
            //         bubbles.style.top = -75 + e.offsetY+'px';
            //         body.appendChild(bubbles);
            //     }
            // })
            // document.addEventListener('touchend', function(e){
            //     touched = false;
            // })

            // new 

            function startup() {
                const el = document.getElementById('canvas');
                el.addEventListener('touchstart', handleStart);
                el.addEventListener('touchend', handleEnd);
                el.addEventListener('touchcancel', handleCancel);
                el.addEventListener('touchmove', handleMove);
                //log('Initialized.');
            }

            document.addEventListener("DOMContentLoaded", startup);

            // handle start

            function handleStart(evt) {
                evt.preventDefault();
                // log('touchstart.');
                const el = document.getElementById('canvas');
                const ctx = el.getContext('2d');
                const touches = evt.changedTouches;
                //added
                const bubbles = document.createElement('span')


                for (let i = 0; i < touches.length; i++) {
                    // log(`touchstart: ${i}.`);
                    console.log(touches[i])
                    ongoingTouches.push(copyTouch(touches[i]));
                    const color = colorForTouch(touches[i]);
                    // log(`color of touch with id ${ touches[i].identifier } = ${ color }`);
                    // ctx.beginPath();
                    // ctx.arc(touches[i].pageX, touches[i].pageY, 4, 0, 2 * Math.PI, false);  // a circle at the start
                    // ctx.fillStyle = color;
                    // ctx.fill();
                    bubbles.style.left = -75 + touches[i].pageX+'px';
                    bubbles.style.top = -75 + touches[i].pageY+'px';
                    el.appendChild(bubbles);
                }
            }

            function handleMove(evt){

            }

            function handleEnd(evt){

            }

            function handleCancel(evt){
                
            }
            function colorForTouch(touch) {
                let r = touch.identifier % 16;
                let g = Math.floor(touch.identifier / 3) % 16;
                let b = Math.floor(touch.identifier / 7) % 16;
                r = r.toString(16); // make it a hex digit
                g = g.toString(16); // make it a hex digit
                b = b.toString(16); // make it a hex digit
                const color = "#" + r + g + b;
                return color;
            }

            function copyTouch({ identifier, pageX, pageY }) {
                return { identifier, pageX, pageY };
            }
            function ongoingTouchIndexById(idToFind) {
                for (let i = 0; i < ongoingTouches.length; i++) {
                    const id = ongoingTouches[i].identifier;

                    if (id == idToFind) {
                    return i;
                    }
                }
                return -1;    // not found
            }
            
        </script>
    </body>
</html>
</html>